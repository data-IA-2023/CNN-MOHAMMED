<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>abc66f16a525483a81ad1aa812f593f3</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<section id="le-deep-learning" class="cell markdown"
data-colab_type="text" id="VhNFp-0y3ej3">
<h2>Le deep learning</h2>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/z-czi5DC2d4?si=WaEsiJowOdsA6iFe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

</section>
<div class="cell markdown" data-colab_type="text" id="tyl8D-uX3ej6">
<p>Aujourd'hui, il existe beaucoup de produits dit "d'Intelligence
Artificielle (IA)", ces applications utilisent majoritairement du
Machine Learning (ML), qui est un sous-domaine de l'IA, comme vous
pouvez le voir ci-dessous. Le machine learning est un champ d'étude qui
permet à des programmes de pouvoir résoudre des problèmes à partir de
données sans les avoir explicitement programmé. Le deep learning est
seulement un des nombreux algorithmes d'apprentissage du machine
learning.</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/data/intelligence_artificielle.png?raw=1" width="400"></p>
</div>
<div class="cell markdown" data-colab_type="text" id="vmC0mhOS3ej7">
<p>Ici, nous allons nous concentrer sur les problèmatiques
d'apprentissage supervisé. Nous allons avoir un jeu de données avec des
variables explicatives A et des labels B. Le but de notre algorithme,
sera d'apprendre à transformer A en B. Comme vous pouvez le voir
ci-dessous, la première étape sera l'entraînement, où l'on donnera des
données d'entraînement A et B à un algorithme d'apprentissage. Une fois
l'entraînement terminé, l'algorithme nous donne un modèle mathématique.
Ce modèle pourra prendre des nouvelles données A' afin de pouvoir
estimer leurs résultats B'</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/data/machine_learning.png?raw=1" width="600"></p>
</div>
<div class="cell markdown" data-colab_type="text" id="6rPyWIDP3ej8">
<p>Le deep learning est un algorithme de machine learning basé sur des
neurones artificiels. Ces neurones sont des unités de calculs, ils
prenent en entrée des informations, les transforment en une valeur et
transmettent cette valeur à d'autres neurones.</p>
<p><img src ="data/neurone.png" width="600" ></p>
<p>Vous pouvez le voir ci-dessous, si l'on met des neurones artificiels
en réseau, nous obtenons un réseau de neurones qui permet de prendre en
entrée des données A et de changer la représentation de ces données afin
de pouvoir transformer plus facilement A en B.</p>
<p><img src ="data/réseau_de_neurones.png" width="600" ></p>
<p>Initiallement, cet algorithme était censé représenter
artificiellement le comportement du cerveau humain. Aujourd'hui, son
fonctionnement est bien loin du fonctionnement du cerveau humain même
s'il y a encore du vocabulaire hérité de cette inspiration
biologique.</p>
</div>
<div class="cell markdown" data-colab_type="text" id="x_KBjlsm3ej9">
<p>L'avantage du deep learning réside dans la superposition de couches.
Cette superposition permet de changer la représentation des données
d'entrées de notre réseau pour mettre en valeur différentes
caractéristiques de notre jeux de données. Cette nouvelle représentation
est élaboré afin de résoudre notre problème plus efficacement. Comme
vous pouvez le voir ci-dessous, ça remplace en partie le processus de
feature engineering indispensable aux modèles de machines learning
classique.</p>
<p><img src ="data/ml_vs_dl.png" width="700" ></p>
<p>Cette force, a permi le développement d'algorithme de deep learning
très robuste capable de mieux comprendre les données non structurés tels
que du texte, du son et des images.</p>
</div>
<section id="les-architectures-de-convolutional-neural-network-cnn"
class="cell markdown" data-colab_type="text" id="Qxt848q03ej-">
<h2>Les architectures de Convolutional Neural Network (CNN)</h2>
<p>Comme nous l'avons vue précédemment, le principal avantage des
réseaux de neurones par rapport aux algorithmes de machine learning
traditionnels est que les algorithmes de deep learning apprennent des
représentations par eux-mêmes, alors que dans le machine learning
traditionnel, on définie des variables à la main sensés être une
meilleure représentation des données. C'est vrai pour les réseaux de
neurones de type "fully connected" qui ne sont constitués que de couches
entièrement connectées. Mais il est très difficile de les entraîner pour
des entrées de haute dimension comme les images.</p>
<p>Lorsque vous utilisez une architecture de CNN, vous utilisez deux
types de fonctionnalités artisanales : les convolutional layers (les
filtres de convolution) et les poolign layers (les filtres de
regroupement).</p>
<p>Le concepteur du CNN pour la classification des images a examiné les
données d'entrée (c'est ce que font les ingénieurs en machine learning
traditionnels pour inventer des fonctionnalités) et a décidé que des
patchs de pixels proches les uns des autres contiennent des informations
qui pourraient aider à la classification, et en même temps réduire le
nombre de paramètres. Vous pouvez voir l'application d'un patch sur une
image ci-dessous.</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/data/application_de_patchs.gif?raw=1" width="500" ></p>
<p>En effet, l'application de patchs sur une image permet de transformer
l'image et de faire ressortir certaines de ces caractéristiques comme
vous pouvez le voir ci-dessous.</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/data/filters.png?raw=1" width="500" ></p>
</section>
<div class="cell markdown" data-colab_type="text" id="Y4Fa3ReO3ej_">
<p>Le but du CNN est de transformer notre image de départ en vecteur qui
serait la représentation vectorielle des caractéristiques de notre
image.</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/data/conv_nn.png?raw=1" width="600" ></p>
<p>Une fois que nous avons extrait les caractéristiques de notre image
sous forme de vecteur, nous pouvons utiliser cette représentation afin
de résoudre un problème lié à notre image. Sur l'illustration
ci-dessous, vous pouvez bien voir les deux différentes parties qui
consistuent notre réseau.</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/data/CNN.png?raw=1" width="800" ></p>
</div>
<section id="exemple-cnn" class="cell markdown" data-colab_type="text"
id="AV1ot3Xk3ekA">
<h2>Exemple CNN</h2>
</section>
<div class="cell markdown" data-colab_type="text" id="W6qKwqUq3ekB">
<p>Ne vous inquiétez pas, vous n'allez pas avoir besoin de connaître
toutes les mathématiques qui se cachent derrière les réseaux
convolutionel pour pouvoir les utiliser. Grâce à Tensorflow et sa
sur-couche Keras, vous pouvez construire un modèle en quelques
cliques.</p>
<h3 id="sélection-du-matériel">Sélection du matériel</h3>
<p>Avant de commencer nous allons sélectionné le matériel adapté à nos
calculs. Le deep learning à besoin de cartes graphiques (GPU) afin de
réduire le temps de calculs.</p>
<p>Appuyer sur "Exécution" -&gt; "Modifier le type d'exécution"</p>
<p>Dans "Accélérateur matériel" sélectionnez GPU puis appuyer sur
enregistrer.</p>
<h3 id="importation-des-packages">Importation des packages</h3>
<p>On va commencer par importer les packages nécessaires à l'élaboration
de notre modèle.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:63}"
data-colab_type="code"
data-executionInfo="{&quot;elapsed&quot;:2738,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1583264147827,&quot;user&quot;:{&quot;displayName&quot;:&quot;&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;&quot;},&quot;user_tz&quot;:-60}"
id="DW0-qPLH3ekC" data-outputId="c7501ec8-1c30-4008-927d-e7de501de190">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> ndimage</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.python.framework <span class="im">import</span> ops</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.optimizers <span class="im">import</span> SGD</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dense, Dropout, Flatten</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Conv2D, MaxPooling2D</span></code></pre></div>
</div>
<section id="importations-des-données" class="cell markdown"
data-colab_type="text" id="HNTkfXAk3ekH">
<h3>Importations des données</h3>
<p>Maintenant que nos outils sont chargés, nous allons charger nos
données.</p>
<p>Cliquez sur le lien ci-dessous :</p>
<p><a
href="https://drive.google.com/open?id=1Wg3FnIydOdu6twEpu3iB8inZghsIIV1d"
class="uri">https://drive.google.com/open?id=1Wg3FnIydOdu6twEpu3iB8inZghsIIV1d</a></p>
<p>Cliquer droit sur le dossier data et appuyer sur ajouter à mon
drive.</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/images/data_google_drive.png?raw=1" width="800" ></p>
</section>
<div class="cell markdown" data-colab_type="text" id="ATBazqHW3ekI">
<p>Exécutez la cellule ci-dessous et appuyer sur le lien proposé.</p>
<p>Suivez les instructions et copier le code ci-dessous.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:122}"
data-colab_type="code"
data-executionInfo="{&quot;elapsed&quot;:35892,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1583264249964,&quot;user&quot;:{&quot;displayName&quot;:&quot;&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;&quot;},&quot;user_tz&quot;:-60}"
id="dxvb9XSi3ekJ" data-outputId="60d09bc8-a6a6-4dd2-8082-f5a8a6eee620">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> drive</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>drive.mount(<span class="st">&#39;/content/gdrive/&#39;</span>)</span></code></pre></div>
</div>
<div class="cell markdown" data-colab_type="text" id="QzuUN6Au3ekM">
<p>Les données sont maintenant dans votre environnement collab.</p>
</div>
<div class="cell code" data-colab="{}" data-colab_type="code"
id="MJJZb0b23ekN">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>train_dataset <span class="op">=</span> h5py.File(<span class="st">&#39;/content/gdrive/My Drive/tp_1/data/train_signs.h5&#39;</span>, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>train_set_x_orig <span class="op">=</span> np.array(train_dataset[<span class="st">&quot;train_set_x&quot;</span>][:])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>train_set_y_orig <span class="op">=</span> np.array(train_dataset[<span class="st">&quot;train_set_y&quot;</span>][:])</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>test_dataset <span class="op">=</span> h5py.File(<span class="st">&#39;/content/gdrive/My Drive/tp_1/data/test_signs.h5&#39;</span>, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>test_set_x_orig <span class="op">=</span> np.array(test_dataset[<span class="st">&quot;test_set_x&quot;</span>][:]) </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>test_set_y_orig <span class="op">=</span> np.array(test_dataset[<span class="st">&quot;test_set_y&quot;</span>][:]) </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>classes <span class="op">=</span> np.array(test_dataset[<span class="st">&quot;list_classes&quot;</span>][:]) </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>train_set_y_orig <span class="op">=</span> train_set_y_orig.reshape((<span class="dv">1</span>, train_set_y_orig.shape[<span class="dv">0</span>]))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>test_set_y_orig <span class="op">=</span> test_set_y_orig.reshape((<span class="dv">1</span>, test_set_y_orig.shape[<span class="dv">0</span>]))</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>input_shape <span class="op">=</span> train_set_x_orig[<span class="dv">0</span>].shape</span></code></pre></div>
</div>
<div class="cell markdown" data-colab_type="text" id="f7-aMDKa3ekQ">
<p>Dans cet exemple, nous allons créer un modèle de deep learning
capable de reconnaître quel chiffre fait la main sur une photo. Comme
vous pouvez le voir ci-dessous, nous avons 5 classes.</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/data/signes.png?raw=1" width="800" ></p>
</div>
<div class="cell markdown" data-colab_type="text" id="FxNNs6_e3ekR">
<p>Vous pouvez directement voir les exemples depuis le jeu de
données.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:285}"
data-colab_type="code"
data-executionInfo="{&quot;elapsed&quot;:1146,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1583264348104,&quot;user&quot;:{&quot;displayName&quot;:&quot;&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;&quot;},&quot;user_tz&quot;:-60}"
id="qAzk8yLr3ekS" data-outputId="48206437-1324-4fa9-c768-e3888a9cafcd">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of a picture</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>plt.imshow(train_set_x_orig[index])</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">&quot;y = &quot;</span> <span class="op">+</span> <span class="bu">str</span>(np.squeeze(train_set_y_orig[:, index])))</span></code></pre></div>
</div>
<div class="cell markdown" data-colab_type="text" id="FnwfVfnp3ekU">
<p>Vous pouvez voir ci-dessous que nos images sont en trois dimensions
64 x 64 x 3.</p>
<p>La première dimension de 64 correspond à la hauteur en pixel de la
photo, ici 64 pixels.</p>
<p>La deuxième dimension de 64 correspond à la largeur en pixel de la
photo, ici 64 pixels.</p>
<p>La troisième dimension correspond aux intensités de rouge, de vert et
de bleu nécessaires pour former la couleur du pixel.</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/data/RGB-color-model.jpg?raw=1" width="300" ></p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:34}"
data-colab_type="code"
data-executionInfo="{&quot;elapsed&quot;:821,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1583264482766,&quot;user&quot;:{&quot;displayName&quot;:&quot;&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;&quot;},&quot;user_tz&quot;:-60}"
id="cbzNSm_u3ekV" data-outputId="fba39907-b488-4cbc-f6f0-fb14092453ff">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(train_set_x_orig[<span class="dv">0</span>].shape)</span></code></pre></div>
</div>
<div class="cell markdown" data-colab_type="text" id="-e_1NNZU3ekY">
<p>Pour créer des images en informatique, il n'y a pas une intensité par
couleur, ce serait trop complexe à organiser. Pour remédier à cela, nous
avons pris trois couleurs (rouge, vert et bleu) et chaque couleur sera
une combinaison d'intensité de ces trois couleurs. Le schéma ci-dessous
va sûrement vous aider à comprendre le problème.</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/data/image_en_rgb.png?raw=1" width="600" ></p>
</div>
<section id="normalisation" class="cell markdown" data-colab_type="text"
id="5cWtHwvk3ekZ">
<h3>Normalisation</h3>
<p>Pour des raisons d'optimisation, nous voulons que les données
d'entrées de notre modèle soient normalisées.</p>
<p>La bonne nouvelle, c'est que les intensités d'une image sont toujours
comprises entre 0 et 255. Nous allons donc utiliser la min-max
normalisation afin de réduire la valeur des intensités de nos
images.</p>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:85}"
data-colab_type="code"
data-executionInfo="{&quot;elapsed&quot;:743,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1583264610467,&quot;user&quot;:{&quot;displayName&quot;:&quot;&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;&quot;},&quot;user_tz&quot;:-60}"
id="ffHEnaSA3ekc" data-outputId="c7ceef76-f435-4a5b-e5be-e814b40477f4">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Valeur maximum de nos images : &#39;</span>,np.<span class="bu">min</span>(train_set_x_orig))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Valeur minimum de nos images : &#39;</span>, np.<span class="bu">max</span>(train_set_x_orig))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> train_set_x_orig.astype(<span class="st">&#39;float32&#39;</span>)<span class="op">/</span><span class="dv">255</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> test_set_x_orig.astype(<span class="st">&#39;float32&#39;</span>)<span class="op">/</span><span class="dv">255</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Valeur maximum de nos images normalisées : &#39;</span>,np.<span class="bu">min</span>(X_train))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Valeur minimum de nos images normalisées : &#39;</span>,np.<span class="bu">max</span>(X_train))</span></code></pre></div>
</div>
<div class="cell markdown" data-colab_type="text" id="VFkIIe363eke">
<p>Dans nos vecteurs "train_set_y_orig" et "test_set_y_orig" nous avons
le chiffre correspondant à l'image de la main.</p>
<p>Nous allons transformer nos valeurs en hot vecteur, c'est-à-dire au
lieu d'avoir la valeur 5 on aura un vecteur avec un 1 à la 6ème
case.</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/data/hot_vecteur.png?raw=1" width="800" ></p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:51}"
data-colab_type="code"
data-executionInfo="{&quot;elapsed&quot;:800,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1583264878718,&quot;user&quot;:{&quot;displayName&quot;:&quot;&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;&quot;},&quot;user_tz&quot;:-60}"
id="-GzAtEE83ekf" data-outputId="9655ea6f-9e74-4930-9fbd-239ac58737ed">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(train_set_y_orig.shape)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(test_set_y_orig.shape)</span></code></pre></div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:51}"
data-colab_type="code"
data-executionInfo="{&quot;elapsed&quot;:825,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1583264907321,&quot;user&quot;:{&quot;displayName&quot;:&quot;&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;&quot;},&quot;user_tz&quot;:-60}"
id="jZ3u2Ha13ekh" data-outputId="c8d67653-67d0-4a99-b0fd-25555ae0a82a">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Y_train <span class="op">=</span> np.eye(<span class="dv">6</span>)[train_set_y_orig.reshape(<span class="op">-</span><span class="dv">1</span>)]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>Y_test <span class="op">=</span> np.eye(<span class="dv">6</span>)[test_set_y_orig.reshape(<span class="op">-</span><span class="dv">1</span>)]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Y_train[<span class="dv">150</span>, :])</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((train_set_y_orig[:, <span class="dv">150</span>]))</span></code></pre></div>
</div>
<section id="construction-de-notre-modèle" class="cell markdown"
data-colab_type="text" id="_szJ9Aob3ekk">
<h3>Construction de notre modèle</h3>
</section>
<div class="cell markdown" data-colab_type="text" id="AuV1On6r3ekk">
<p>Ici nous allons créer un modèle basique de CNN.</p>
</div>
<div class="cell code" data-colab="{}" data-colab_type="code"
id="fPTbk3sh3ekl">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span></code></pre></div>
</div>
<div class="cell markdown" data-colab_type="text" id="p3ZrNjPY3eko">
<p>Nous allons commencer notre modèle par une couche de convolution.
Comme vous pouvez voir ci-dessous, c'est simplement l'application d'un
filtre sur notre image pour extraire des caractéristiques.</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/data/convolution_anim.gif?raw=1" width="800" ></p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:88}"
data-colab_type="code"
data-executionInfo="{&quot;elapsed&quot;:724,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1583264996127,&quot;user&quot;:{&quot;displayName&quot;:&quot;&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;&quot;},&quot;user_tz&quot;:-60}"
id="LY_ZTUy83ekp" data-outputId="958cbe68-57fd-468f-e1eb-fe1fab46ea9d">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>model.add(Conv2D(<span class="dv">32</span>, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                 kernel_size<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                 activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                 input_shape<span class="op">=</span>(<span class="dv">64</span>,<span class="dv">64</span>,<span class="dv">3</span>)))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>model.add(Conv2D(<span class="dv">32</span>, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                 kernel_size<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                 activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                 input_shape<span class="op">=</span>(<span class="dv">64</span>,<span class="dv">64</span>,<span class="dv">3</span>)))</span></code></pre></div>
</div>
<div class="cell markdown" data-colab_type="text" id="GlheyBYU3ekr">
<p>Nous allons maintenant ajouter une couche de max-pooling. Comme vous
pouvez voir ci-dessous, c'est simplement la sélection de l'intensité la
plus grande parmi une sélection de pixels.</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/data/pooling_anim.gif?raw=1" width="800" ></p>
</div>
<div class="cell code" data-colab="{}" data-colab_type="code"
id="r0veTzeM3eks">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>model.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span></code></pre></div>
</div>
<div class="cell markdown" data-colab_type="text" id="EeeXcqM53eku">
<p>Maintenant que nous avons extrait des informations de notre image,
nous allons transformer ces représentations en vecteur.</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/data/flatten.gif?raw=1" width="500" ></p>
</div>
<div class="cell code" data-colab="{}" data-colab_type="code"
id="sB8oY1au3ekv">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>model.add(Flatten())</span></code></pre></div>
</div>
<div class="cell markdown" data-colab_type="text" id="AlOWsYGi3eky">
<p>Pour finir, nous allons utiliser des couches entièrement connectées
pour prédire l'appartenance de nos observations à nos classes.</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/data/fully_connected.png?raw=1" width="500" ></p>
</div>
<div class="cell code" data-colab="{}" data-colab_type="code"
id="Z87lJOIB3eky">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>model.add(Dense(<span class="dv">6</span>, activation<span class="op">=</span><span class="st">&#39;softmax&#39;</span>))</span></code></pre></div>
</div>
<div class="cell markdown" data-colab_type="text" id="2Ixeu8bi3ek1">
<p>Notre modèle est assemblé, nous pouvons maintenant le visualiser.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:323}"
data-colab_type="code"
data-executionInfo="{&quot;elapsed&quot;:776,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1583265108937,&quot;user&quot;:{&quot;displayName&quot;:&quot;&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;&quot;},&quot;user_tz&quot;:-60}"
id="ACtAy0ph3ek2" data-outputId="2c5283dd-a56a-4069-a3a2-88ebb20fa59f">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code></pre></div>
</div>
<div class="cell markdown" data-colab_type="text" id="LzJr3QHV3ek4">
<p>Voici une représentation plus visuelle du modèle.</p>
<p><img src="https://github.com/MorganGautherot/Tuto_MRI_ML/blob/master/tp_1/data/baseline.png?raw=1" width="800" ></p>
</div>
<div class="cell markdown" data-colab_type="text" id="Fhq9mk3A3ek4">
<p>Nous voilà à la dernière étape, l'entraînement de notre modèle.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
data-colab_type="code"
data-executionInfo="{&quot;elapsed&quot;:41772,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1583265207156,&quot;user&quot;:{&quot;displayName&quot;:&quot;&quot;,&quot;photoUrl&quot;:&quot;&quot;,&quot;userId&quot;:&quot;&quot;},&quot;user_tz&quot;:-60}"
id="z1z-n9Ob3ek5" data-outputId="ad4a8582-1fc5-44f3-a653-576238dc45cb">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">&quot;categorical_crossentropy&quot;</span>, optimizer<span class="op">=</span>SGD(lr<span class="op">=</span><span class="fl">0.01</span>), metrics<span class="op">=</span>[<span class="st">&quot;accuracy&quot;</span>])</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, Y_train,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>          epochs <span class="op">=</span> <span class="dv">100</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>          validation_data<span class="op">=</span>(X_test, Y_test))</span></code></pre></div>
</div>
<div class="cell markdown" data-colab_type="text" id="YxQn2LWY3ek7">
<p>Pour finir ce notebook, nous allons sauvegarder les paramètres de
notre modèle si nous voulons l'utiliser à nouveau plus tard.</p>
</div>
<div class="cell code" data-colab="{}" data-colab_type="code"
id="bU55lxoZ3ek8">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>model.save_weights(<span class="st">&quot;model.h5&quot;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-colab="{}" data-colab_type="code"
id="zUdHE_7e3ek-">
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
</body>
</html>
